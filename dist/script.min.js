const cnpjForm=document.getElementById("cnpjForm"),cnpjInput=document.getElementById("cnpj"),resultsDiv=document.getElementById("results"),cnpjDataContainer=document.getElementById("cnpjDataContainer"),loadingDiv=document.getElementById("loading"),errorMessageDiv=document.getElementById("errorMessage");function applyCNPJMask(e){let t=e.replace(/\D/g,"");return t.length<14?t:t.replace(/^([0-9]{2})([0-9]{3})([0-9]{3})([0-9]{4})([0-9]{2})$/,"$1.$2.$3/$4-$5")}function isValidCNPJ(e){const t=e.replace(/\D/g,"");if(14!==t.length)return!1;if(/^(\d)\1+$/.test(t))return!1;function a(e,t){let a=0;for(let n=0;n<t.length;n++)a+=parseInt(e[n])*t[n];const n=a%11;return n<2?0:11-n}const n=a(t.substring(0,12),[5,4,3,2,9,8,7,6,5,4,3,2]),s=a(t.substring(0,12)+n,[6,5,4,3,2,9,8,7,6,5,4,3,2]);return t.substring(12)===n.toString()+s.toString()}cnpjInput.addEventListener("input",(function(e){let t=e.target.value.replace(/\D/g,"");t.length>14&&(t=t.slice(0,14)),e.target.value=applyCNPJMask(t)})),cnpjForm.addEventListener("submit",(function(e){const t=cnpjInput.value.replace(/\D/g,"");if(!isValidCNPJ(t))return e.preventDefault(),errorMessageDiv.textContent="CNPJ inválido. Por favor, digite um CNPJ válido.",void(errorMessageDiv.style.display="block");errorMessageDiv.style.display="none"}));const fieldLabels={abertura:"Data de Abertura",situacao:"Situação",tipo:"Tipo",nome:"Nome Empresarial",fantasia:"Nome Fantasia",porte:"Porte",natureza_juridica:"Natureza Jurídica",logradouro:"Logradouro",numero:"Número",complemento:"Complemento",cep:"CEP",bairro:"Bairro",municipio:"Município",uf:"UF",email:"E-mail",telefone:"Telefone",efr:"EFR",motivo_situacao:"Motivo Situação",situacao_especial:"Situação Especial",data_situacao_especial:"Data Situação Especial",capital_social:"Capital Social",ultima_atualizacao:"Última Atualização",status:"Status (API)",cnpj:"CNPJ (Consultado)",qsa:"Quadro de Sócios e Administradores",atividade_principal:"Atividade Principal",atividades_secundarias:"Atividades Secundárias",code:"Código",text:"Descrição",qual:"Qualificação"};function createField(e,t){const a=document.createElement("div");a.className="result-field-group p-3 rounded-md animate-fadeIn";const n=document.createElement("div");n.className="result-field-label text-xs uppercase tracking-wider mb-1",n.textContent=e,a.appendChild(n);const s=document.createElement("input");return s.type="text",s.value=t,s.readOnly=!0,s.className="w-full px-3 py-1.5 rounded-md shadow-sm text-sm result-field-value focus:outline-none",s.addEventListener("click",(function(){this.select();try{document.execCommand("copy");const e=this.style.backgroundColor;this.style.backgroundColor="#2d57a0",setTimeout((()=>{this.style.backgroundColor=e}),300)}catch(e){console.warn("Não foi possível copiar automaticamente.")}})),a.appendChild(s),a}function displayCnpjData(e){function t([e,a],n,s=""){const o=fieldLabels[e]||e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()));if("object"==typeof a&&null!==a)if(Array.isArray(a)){const r=document.createElement("h3");r.className="text-lg font-semibold text-blue-400 mt-5 mb-2 col-span-3 border-t border-gray-700 pt-3 futuristic-title text-opacity-80",r.textContent=fieldLabels[s]||o,n.appendChild(r),0===a.length?n.appendChild(createField(o,"Nenhuma informação disponível")):a.forEach(((a,s)=>{const r=document.createElement("div");if(r.className="ml-4 pl-4 border-l-2 border-gray-700 animate-fadeIn",n.appendChild(r),"object"==typeof a&&null!==a){const n=a.nome||a.text||(a.code?`${fieldLabels.code}: ${a.code}`:`Item ${s+1}`),o=document.createElement("p");o.className="text-sm font-medium text-gray-400 mt-2 mb-1",o.textContent=n,r.appendChild(o),Object.entries(a).forEach((s=>{"nome"===s[0]||"text"===s[0]||"code"===s[0]&&a.code===n.split(": ")[1]||t(s,r,e)}))}else r.appendChild(createField(`${o} ${s+1}`,a))}))}else Object.entries(a).forEach((a=>t(a,n,e)));else n.appendChild(createField(o,null!=a?a:"N/A"))}console.log("Iniciando displayCnpjData com dados:",e),e?(cnpjDataContainer.innerHTML="",resultsDiv.style.opacity=0,Object.entries(e).forEach((e=>t(e,cnpjDataContainer))),resultsDiv.style.display="block",resultsDiv.offsetWidth,resultsDiv.style.opacity=1,resultsDiv.classList.add("animate-slideInUp")):console.error("Dados inválidos recebidos em displayCnpjData")}function isValidCNPJ(e){if(""==(e=e.replace(/[^\d]+/g,"")))return!1;if(14!=e.length)return!1;if("00000000000000"==e||"11111111111111"==e||"22222222222222"==e||"33333333333333"==e||"44444444444444"==e||"55555555555555"==e||"66666666666666"==e||"77777777777777"==e||"88888888888888"==e||"99999999999999"==e)return!1;let t=e.length-2,a=e.substring(0,t),n=e.substring(t),s=0,o=t-7;for(let e=t;e>=1;e--)s+=a.charAt(t-e)*o--,o<2&&(o=9);let r=s%11<2?0:11-s%11;if(r!=n.charAt(0))return!1;t+=1,a=e.substring(0,t),s=0,o=t-7;for(let e=t;e>=1;e--)s+=a.charAt(t-e)*o--,o<2&&(o=9);return r=s%11<2?0:11-s%11,r==n.charAt(1)}cnpjForm.addEventListener("submit",(async function(e){console.log("Formulário submetido"),e.preventDefault(),resultsDiv.style.display="none",resultsDiv.classList.remove("animate-slideInUp"),cnpjDataContainer.innerHTML="",errorMessageDiv.style.display="none",errorMessageDiv.textContent="",loadingDiv.style.display="block";let t=cnpjInput.value.replace(/\D/g,"");if(14!==t.length||!isValidCNPJ(t))return errorMessageDiv.textContent="CNPJ inválido. Verifique o número e tente novamente.",errorMessageDiv.style.display="block",errorMessageDiv.classList.add("animate-fadeIn"),void(loadingDiv.style.display="none");errorMessageDiv.classList.remove("animate-fadeIn");const a=`https://corsproxy.io/?${encodeURIComponent(`https://receitaws.com.br/v1/cnpj/${t}`)}`;try{const e=await fetch(a,{headers:{Accept:"application/json"}});if(!e.ok){let t=`Erro na requisição: ${e.status} ${e.statusText}`;try{const a=await e.json();a&&a.message?t=`Erro: ${a.message} (Status: ${a.status||e.status})`:"string"==typeof a&&a.length<200&&(t=a)}catch(t){console.warn("Não foi possível parsear a resposta de erro como JSON:",t);try{const t=await e.text();t&&t.length<500&&console.error("Resposta de erro (texto):",t)}catch(e){}}throw new Error(t)}const t=await e.json();if("ERROR"===t.status)throw new Error(t.message||"Erro ao consultar o CNPJ na API ReceitaWS.");if(console.log("Dados recebidos da API:",t),"OK"!==t.status)throw new Error(t.message||"Resposta inesperada da API ReceitaWS. Verifique os dados retornados.");console.log("Status OK, exibindo dados..."),displayCnpjData(t)}catch(e){console.error("Falha ao buscar CNPJ:",e),errorMessageDiv.textContent=`${e.message}. Verifique o CNPJ ou tente novamente.`,errorMessageDiv.style.display="block",errorMessageDiv.classList.add("animate-fadeIn")}finally{loadingDiv.style.display="none"}})),cnpjInput.addEventListener("input",(function(e){let t=e.target.value.replace(/\D/g,"");t=t.substring(0,14);let a="";t.length>2?(a+=t.substring(0,2)+".",t.length>5?(a+=t.substring(2,5)+".",t.length>8?(a+=t.substring(5,8)+"/",t.length>12?a+=t.substring(8,12)+"-"+t.substring(12,14):a+=t.substring(8,12)):a+=t.substring(5)):a+=t.substring(2)):a=t,e.target.value=a}));